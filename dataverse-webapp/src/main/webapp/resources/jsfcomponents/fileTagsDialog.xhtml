<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:jsf="http://xmlns.jcp.org/jsf" xmlns:composite="http://xmlns.jcp.org/jsf/composite">


<composite:interface>
    <composite:attribute name="dialogWidgetId" required="true"/>
    <composite:attribute name="dialogId" required="true"/>
    <composite:attribute name="fileMetadata" required="true"
                         type="edu.harvard.iq.dataverse.persistence.datafile.FileMetadata"/>
    <composite:attribute name="fileMetadatas" type="java.util.List"/>
    <composite:attribute name="dataset" required="true"
                         type="edu.harvard.iq.dataverse.persistence.dataset.Dataset"/>

    <composite:clientBehavior name="saveAction" targets="fileTagsPopupSaveButton"
                              event="click"/> <!--selectedTagsListEFF-->
</composite:interface>


<composite:implementation>
    <p:dialog styleClass="smallPopUp" header="#{bundle['file.editTags']}"
              widgetVar="#{cc.attrs.dialogWidgetId}" modal="true">

        <p class="help-block">#{bundle['file.editTagsDialog.tip']}</p>
        <div class="form-horizontal" jsf:rendered="#{!(empty FileTagModal.selectedFileMetadataTags)}">
            <div class="form-group text-left">
                <label for="selectedTagsList" class="col-sm-4 control-label">
                    #{bundle['file.editTagsDialog.selectedTags']}
                </label>
                <div class="col-sm-8">
                    <p:outputPanel id="selectedTagsList" style="padding-top:.5em;">
                        <h:outputText value="#{bundle['file.editTagsDialog.selectedTags.none']}"
                                      rendered="#{(empty FileTagModal.selectedFileMetadataTags) and (empty FileTagModal.selectedDataFileTags)}"/>

                        <ui:repeat value="#{FileTagModal.selectedFileMetadataTags}" var="tags"
                                   rendered="#{!empty FileTagModal.selectedFileMetadataTags}">
                            <h:outputText value="#{tags}" styleClass="label label-default"
                                          style="margin-right:.5em;display:inline-block;"/>
                        </ui:repeat>
                        <ui:repeat value="#{FileTagModal.selectedDataFileTags}" var="tags"
                                   rendered="#{!empty FileTagModal.selectedDataFileTags}">
                            <h:outputText value="#{tags}" styleClass="label label-info"
                                          style="margin-right:.5em;display:inline-block;"/>
                        </ui:repeat>
                    </p:outputPanel>
                </div>
            </div>
            <div class="form-group text-left">
                <label for="fileTagsMenuDS" class="col-sm-4 control-label">
                    #{bundle['file.editTagsDialog.select']}
                </label>
                <div class="col-sm-8">
                    <p:selectCheckboxMenu id="fileTagsMenuDS" styleClass="form-control"
                                          value="#{FileTagModal.selectedFileMetadataTags}" label="#{bundle.select}">

                        <p:ajax event="toggleSelect" listener="#{FileTagModal.handleSelection}"
                                update="selectedTagsList"/>
                        <p:ajax event="change" listener="#{FileTagModal.handleSelection}"
                                update="selectedTagsList"/>

                        <f:selectItems value="#{FileTagModal.fileMetadataTags}"/>
                    </p:selectCheckboxMenu>
                    <p:message for="fileTagsMenuDS" display="text"/>
                </div>
            </div>
            <div class="form-group text-left">
                <label for="fileTagAddNewDS" class="col-sm-4 control-label">
                    #{bundle['file.editTagsDialog.add']}
                </label>
                <div class="col-sm-8">
                    <div class="row form-inline">
                        <div class="col-sm-12">
                            <p class="help-block">#{bundle['file.editTagsDialog.add.tip']}</p>
                            <p:inputText id="fileTagAddNewDS" styleClass="form-control"
                                         type="text" value="#{FileTagModal.newCategoryName}"
                                         placeholder="#{bundle['file.editTagsDialog.newName']}"
                                         onkeypress="if (event.keyCode == 13) {
                                                                     return false;
                                                                 }"/>
                            <p:commandLink styleClass="btn btn-default" style="margin-left:.5em;"
                                           value="#{bundle.apply}" action="#{FileTagModal.saveNewCategory}"
                                           update="selectedTagsList, fileTagAddNewDS, fileTagsMenuDS"/>
                        </div>
                    </div>
                    <p:message for="fileTagAddNewDS" display="text"/>
                </div>
            </div>
            <div class="form-group text-left" jsf:rendered="#{FileTagModal.isTabularFile()}">
                <label for="tabularDataTagsDSPage" class="col-sm-4 control-label">
                    #{bundle['file.tabularDataTags']}
                </label>
                <div class="col-sm-8">
                    <p class="help-block">#{bundle['file.tabularDataTags.tip']}</p>
                    <p:selectCheckboxMenu id="tabularDataTagsDSPage" styleClass="form-control"
                                          value="#{FileTagModal.selectedDataFileTags}"
                                          label="#{bundle.select}"
                                          filter="false">

                        <p:ajax event="toggleSelect" listener="#{FileTagModal.handleSelection}"
                                update="selectedTagsList"/>
                        <p:ajax event="change" listener="#{FileTagModal.handleSelection}"
                                update="selectedTagsList"/>

                        <f:selectItems value="#{FileTagModal.dataFileTags}"/>
                    </p:selectCheckboxMenu>
                    <p:message for="tabularDataTagsDSPage" display="text"/>
                </div>
            </div>
            <div class="form-group text-left">
                <label class="col-sm-4 control-label">
                    #{bundle['dataset.removeUnusedFileTags.label']}
                </label>
                <div class="col-sm-8">
                    <p class="help-block">#{bundle['dataset.removeUnusedFileTags.tip']}</p>
                    <p:selectBooleanCheckbox id="removeUnused"
                                             itemLabel="#{bundle['dataset.removeUnusedFileTags.check']}"
                                             value="#{FileTagModal.removeUnusedTags}"
                                             widgetVar="removeUnused"/>
                </div>
            </div>
        </div>
        <div class="button-block">
            <p:commandButton styleClass="btn btn-default" id="fileTagsPopupSaveButton"
                             value="#{bundle.saveChanges}" oncomplete="PF('fileTagsPopup').hide()"
                             update="@widgetVar(filesTable), @form"/>
            <p:commandButton styleClass="btn btn-default" id="fileTagsPopupCancelButton"
                             value="#{bundle.cancel}"
                             onclick="PF('fileTagsPopup').hide();PF('blockDatasetForm').hide();"/>
        </div>
    </p:dialog>
</composite:implementation>

</html>