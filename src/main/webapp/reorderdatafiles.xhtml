<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:jsf="http://xmlns.jcp.org/jsf"
      xmlns:o="http://omnifaces.org/ui"
>
<h:head>
</h:head>
<h:body>
    <ui:composition template="/dataverse_template.xhtml">
        <o:importFunctions type="java.lang.Math"/>
        <ui:define name="body">
            <f:metadata>
                <f:viewParam name="id" value="#{ReorderDataFilesPage.dataset.id}"/>
                <f:viewAction action="#{DatasetPage.init}" rendered="true"/>
            </f:metadata>
            <!-- Files Table -->
            <p:dataTable id="filesTable"
                         style="margin-right:1px;"
                         value="#{ReorderDataFilesPage.fileMetadatas}"
                         emptyMessage="#{bundle['file.notFound.tip']}">

                <f:facet name="header">
                    <div class="row form-inline" jsf:id="cloudStorageBlock"
                         jsf:rendered="#{DatasetPage.showComputeButton()}">
                        <!-- Cloud Storage Access -->
                        <div class="form-group col-xs-12 text-left">
                            <div class="col-xs-12">
                                <p class="help-block text-muted"><span class="glyphicon glyphicon-info-sign"/>
                                    <h:outputFormat value=" #{bundle['file.cloudStorageAccess.help']}" escape="false">
                                        <f:param value="#{systemConfig.guidesBaseUrl}"/>
                                        <f:param value="#{systemConfig.guidesVersion}"/>
                                        <f:param value="#{DatasetPage.cloudEnvironmentName}"/>
                                    </h:outputFormat>
                                </p>
                            </div>
                            <label class="col-sm-3 control-label">
                        <span data-toggle="tooltip" data-placement="auto top" class="tooltiplabel text-info"
                              data-original-title="#{bundle['file.cloudStorageAccess.tip']}">
                            #{bundle['file.cloudStorageAccess']}
                        </span>
                            </label>
                            <div class="col-md-4 col-sm-5 col-xs-6 input-group">
                                <div id="copy-input" class="form-control">#{DatasetPage.swiftContainerName}</div>
                                <span class="input-group-btn">
                            <button class="btn btn-default btn-copy" type="button" id="copy-button"
                                    data-clipboard-action="copy" data-clipboard-target="#copy-input">
                              <span class="glyphicon glyphicon-copy"></span> #{bundle['file.copy']}
                            </button>
                        </span>
                                <script>
                                    $(document).ready(function () {
                                        // clipboard.js > cloud storage copy btn
                                        var clipboard = new Clipboard('button.btn-copy');

                                        clipboard.on('success', function (e) {
                                            console.log(e);
                                        });
                                        clipboard.on('error', function (e) {
                                            console.log(e);
                                        });
                                    });
                                </script>
                            </div>
                        </div>
                    </div>
                    <div jsf:id="filesHeaderBlock" class="row"
                         jsf:rendered="#{DatasetPage.workingVersion.fileMetadatas.size() gt 1}">
                        <div class="col-xs-6">
                            <!-- dataset file search -->
                            <div class="input-group">
                                <p:inputText id="searchFiles" styleClass="form-control"
                                             value="#{DatasetPage.fileLabelSearchTerm}" widgetVar="inputSearchTerm"
                                             onkeypress="if (event.keyCode == 13) { submitsearch(); return false; }"/>
                                <p:watermark for="searchFiles" value="#{bundle['file.search.placeholder']}"/>
                                <h:inputHidden id="showAccessPopup" value="#{DatasetPage.showAccessPopup}"/>
                                <p:remoteCommand name="submitsearch" action="#{DatasetPage.updateFileSearch()}"
                                                 process="@this @widgetVar(inputSearchTerm)" update="@form"
                                                 partialSubmit="true"/>

                                <span class="input-group-btn">
                            <p:commandLink styleClass="btn btn-default" action="#{DatasetPage.updateFileSearch()}"
                                           process="@this @widgetVar(inputSearchTerm)" update="@form"
                                           partialSubmit="true">
                                <span class="glyphicon glyphicon-search"></span> #{bundle['dataverse.search.btn.find']}
                            </p:commandLink>
                        </span>
                            </div>
                        </div>
                    </div>
                    <div class="row" style="margin-bottom:6px;">
                        <div jsf:id="filesHeaderCount" class="col-xs-3 text-left">
                            <!-- Files Count -->
                            <h:outputFormat
                                    value="#{DatasetPage.fileMetadatasSearch.size() == 1 ? bundle['file.count.one'] : bundle['file.count']}"
                                    styleClass="highlightBold"
                                    rendered="#{DatasetPage.fileMetadatasSearch.size() gt 0}">
                                <f:param value="#{(DatasetPage.filePaginatorPage * DatasetPage.rowsPerPage) + 1}"/>
                                <f:param
                                        value="#{Math:min((DatasetPage.filePaginatorPage + 1) * DatasetPage.rowsPerPage,DatasetPage.fileMetadatasSearch.size()) }"/>
                                <f:param value="#{DatasetPage.fileMetadatasSearch.size()}"/>
                            </h:outputFormat>
                        </div>

                        <div class="col-xs-9">
                            <p:outputPanel id="filesButtons">
                                <!-- 4.2.1: replaced permissionsWrapper.canIssueUpdateDatasetCommand(DatasetPage.dataset) with DatasetPage.canUpdateDataset() -->
                                <!-- tab-header pull-right -->
                                <div jsf:id="uploadComputeBlock" class="button-block pull-right no-margin-top"
                                     jsf:rendered="#{!(DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE')
                                         and (DatasetPage.canUpdateDataset()
                                         or (!(empty DatasetPage.workingVersion.fileMetadatas) and DatasetPage.workingVersion.fileMetadatas.size() > 1))}">

                                </div>
                            </p:outputPanel>
                        </div>
                    </div>

                    <div class="row" jsf:rendered="#{DatasetPage.selectedFiles.size() gt 0}">

                    </div>
                </f:facet>

                <p:column selectionMode="multiple" class="text-center" style="width:20px !important;"/>
                <p:column class="col-file-thumb" style="width:64px !important;">
                </p:column>
                <p:column class="col-file-metadata">

                    <ui:fragment rendered="#{!empty fileMetadata.dataFile.globalIdString}">
                        <!-- rendered="# {!(fileMetadata.datasetVersion.released or fileMetadata.datasetVersion.deaccessioned)}" -->
                        <a href="#{widgetWrapper.wrapURL('/file.xhtml?persistentId='.concat(fileMetadata.dataFile.globalIdString).concat('&amp;version=').concat(fileMetadata.datasetVersion.friendlyVersionNumber))}">
                            #{fileMetadata.label}
                        </a>
                    </ui:fragment>
                    <ui:fragment rendered="#{empty fileMetadata.dataFile.globalIdString}">
                        <a href="#{widgetWrapper.wrapURL('/file.xhtml?fileId='.concat(fileMetadata.dataFile.id).concat('&amp;version=').concat(fileMetadata.datasetVersion.friendlyVersionNumber))}">
                            #{fileMetadata.label}
                        </a>
                    </ui:fragment>

                    <!-- TYPE + SIZE + DATE + CHECKSUM -->
                    <div class="text-muted small">
                        <!-- id:#{fileMetadata.dataFile.id} -->
                        <h:outputText id="fileTypeOutputRegular" value="#{fileMetadata.dataFile.friendlyType}"
                                      rendered="#{!(fileMetadata.dataFile.tabularData)}"/>
                        <h:outputText id="fileTypeOutputTabular" value="#{bundle['file.type.tabularData']}"
                                      rendered="#{fileMetadata.dataFile.tabularData}"/>
                        <h:outputText id="fileSize" value=" - #{fileMetadata.dataFile.friendlySize}"
                                      rendered="#{!(DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE')}"/>

                        <h:outputText id="fileCreatePublishDate" value=" - #{fileMetadata.getFileDateToDisplay()}"
                                      rendered="#{!(empty fileMetadata.id)}"/>

                        <h:outputFormat id="fileDownloadCount" value=" - {0} #{bundle['metrics.downloads']}"
                                        rendered="#{!(DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE' or settingsWrapper.rsyncOnly)}">
                            <f:param value="#{DatasetPage.getGuestbookResponseCount(fileMetadata)}"/>
                        </h:outputFormat>

                        <div class="checksum-block" jsf:rendered="#{!fileMetadata.dataFile.tabularData}">
                            <h:outputText id="file-checksum"
                                          value="#{fileMetadata.dataFile.checksumType}: #{fileMetadata.dataFile.checksumValue}"
                                          rendered="#{!(empty fileMetadata.dataFile.checksumValue) and ((DatasetPage.editMode != 'FILE' and DatasetPage.editMode != 'CREATE') or !DatasetPage.isDuplicate(fileMetadata))}"/>
                        </div>
                    </div>
                    <!-- UNF + Variables, Obsersvations -->
                    <div class="text-muted small" jsf:rendered="#{fileMetadata.dataFile.tabularData}">
                        <h:outputText id="fileNumVars"
                                      value="#{fileMetadata.dataFile.dataTable.varQuantity} #{bundle['file.metaData.dataFile.dataTab.variables']}, "
                                      rendered="#{fileMetadata.dataFile.tabularData}"/>
                        <h:outputText id="fileNumObs"
                                      value="#{fileMetadata.dataFile.dataTable.caseQuantity} #{bundle['file.metaData.dataFile.dataTab.observations']} #{!empty fileMetadata.dataFile.unf ? ' - ' : ''}"
                                      rendered="#{fileMetadata.dataFile.tabularData}"/>
                        <h:outputText id="fileUNF" value="#{fileMetadata.dataFile.unf}"
                                      rendered="#{!empty fileMetadata.dataFile.unf}"/>
                    </div>

                    <div class="fileDescription small" jsf:rendered="#{!(empty fileMetadata.description)}">
                        <h:outputText id="fileDescNonEmpty" value="#{fileMetadata.description}"
                                      rendered="#{!(DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE') and !(empty fileMetadata.description)}"/>
                    </div>

                    <div class="file-tags-block #{DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE' ? 'margin-top-half' : ''}"
                         jsf:rendered="#{!(empty fileMetadata.categories) or !(empty fileMetadata.dataFile.tags)}">
                        <ui:fragment rendered="#{!(empty fileMetadata.categories)}">
                            <ui:repeat value="#{fileMetadata.categories}" var="cat">
                                <h:outputText value="#{cat.name}" styleClass="label label-default"/>
                            </ui:repeat>
                        </ui:fragment>
                        <ui:fragment>
                            <ui:repeat value="#{fileMetadata.dataFile.tags}" var="tag">
                                <h:outputText value="#{tag.typeLabel}" styleClass="label label-info"/>
                            </ui:repeat>
                        </ui:fragment>
                    </div>
                </p:column>
                <p:column class="col-file-action text-right #{settingsWrapper.rsyncOnly ? 'col-file-access' : ''}"
                          rendered="#{!(DatasetPage.editMode == 'FILE' or DatasetPage.editMode == 'CREATE')}">

                    <div id="txtInprogess" class="bg-info text-info text-center margin-bottom-half"
                         jsf:rendered="#{fileMetadata.dataFile.ingestInProgress}">
                        <!-- Ingest in progress... -->
                        #{bundle['file.ingestInProgress']}
                    </div>

                    <!---Modular configure-->
                    <ui:fragment
                            rendered="#{!widgetWrapper.widgetView and DatasetPage.sessionUserAuthenticated and DatasetPage.canUpdateDataset() and (DatasetPage.getConfigureToolsForDataFile(fileMetadata.dataFile.id).size() > 0 or worldMapPermissionHelper.canUserSeeMapDataButtonFromPage(fileMetadata) or worldMapPermissionHelper.canSeeMapButtonReminderToPublishFromPage(fileMetadata))}">
                        <ui:include src="file-configure-dropdown-fragment.xhtml">
                            <ui:param name="configureTools"
                                      value="#{DatasetPage.getConfigureToolsForDataFile(fileMetadata.dataFile.id)}"/>
                            <ui:param name="fileId" value="#{fileMetadata.dataFile.id}"/>
                            <ui:param name="canUpdateDataset" value="#{DatasetPage.canUpdateDataset()}"/>
                        </ui:include>
                    </ui:fragment>

                    <div class="col-xs-12 text-left small" jsf:rendered="#{fileMetadata.dataFile.filePackage}">
                        <!-- Data Access for Rsync Download -->
                        <ui:include src="file-data-access-fragment.xhtml">
                            <ui:param name="fileMetadata" value="#{fileMetadata}"/>
                            <ui:param name="datasetVersion" value="#{DatasetPage.workingVersion}"/>
                            <ui:param name="fileDownloadService" value="#{DatasetPage.fileDownloadService}"/>
                        </ui:include>
                    </div>
                </p:column>
            </p:dataTable>
        </ui:define>
    </ui:composition>
</h:body>
</html>
